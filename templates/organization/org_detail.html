{% extends "organization/base.html" %}

{% load bootstrap4 %}

{% block sidebar %}
<div class="db-btn-holder"><button class="blue-btn-org"><a href="{% url 'dashboard:index' %}">Go back to dsashboard</a></button></div>
<div class="member-holder">
  <div class="org-status">
      <h1>Owner</h1>
  </div>
  <div class="member">
      <div class="member-img"><img src="{{ item.owner.profile.profile_picture.url }}" alt=""></div>
      <div class="member-info">
        {{ item.owner.profile.name }} <br>
        @{{ item.owner.username }}
      </div>
  </div>

<div class="org-status">
    <h1>Admins</h1>
</div>
{% for member in item.admins.all %}
  <div class="member">
      <div class="member-img"><img src="{{ member.profile.profile_picture.url }}" alt=""></div>
      <div class="member-info">
          {{ member.profile.name }} <br>
          @{{ member.username }}
      </div>
  </div>
{% empty %}
<div class="container text-center">
    <p>No admins yet!</p>
</div>
{% endfor %}

<div class="org-status">
    <h1>Members</h1>
</div>
{% for member in item.members.all %}
  <div class="member">
      <div class="member-img"><img src="{{ member.profile.profile_picture.url }}" alt=""></div>
      <div class="member-info">
          {{ member.profile.name }} <br>
          @{{ member.username }}
      </div>
  </div>
{% empty %}
<div class="container text-center">
    <p>No Members yet!</p>
</div>
{% endfor %}

</div>
{% endblock sidebar %}


{% block maincontent %}
<div class="group-desc mb-3">
    <div class="group-cover">
        <img src="{{ item.cover.url }}" alt="">
    </div>
    <div class="group-credentials p-2">
        <h4>{{ item.name }}</h4>
        <p>{{ item.description }}</p>
        <p><i class="bi bi-people-fill"></i> <span>{{ item.members.all.count }}</span></p>    
    </div>
</div>

{% if user == item.owner or user in item.admin.all %}
<div class="container-fluid mb-3">
  <h1 class="title-text">Add a Member</h1>
  <form method="POST">
    {% csrf_token %}
    <div class="content-holder">
      <div class="content-holder-left user-form-extend">{% bootstrap_form member_form %}</div>
      <button class="content-holder-right btn"><input class="blue-btn-org" type="submit" value="Add member"></button>
    </div>
    
  </form>
</div>
{% endif %}

<div class="container mt-3 mb-3">
  <h1 class="title-text">{{ item.title }} Work:</h1>
  <div class="row">
    <div class="display-flex col-sm-6">
      {% for work in all_work  %}
      <div class="card m-1">
        <div class="card-body">
          <h5 class="card-title">{{ work.title }}</h5>
          <p class="card-text">{{ work.description }}</p>
          {% if work.is_complete %}
            Completed
          {% else %}
          Not completed
          {% endif %}
          {% if work.assigned_to %}
          <p class="card-text"><b>Assigned to:</b> {{ work.assigned_to }}</p>
          <p><b>Status:</b><button class="status-symbol status-green">Assigned</button></p>
          {% else %}
          <p><b>Status:</b><button class="status-symbol status-red">Not Assigned</button></p>
          {% endif %}
          {% if user == work.assigned_to %}
            <a class="blue-btn-org" href="{% url 'org:update-work' pk=work.pk  slug=item.slug %}">Complete</a>
          {% endif %}
          <a href="{% url 'org:detail-work' pk=work.pk  slug=item.slug %}" class="blue-btn-org">Details</a>
        </div>
      </div>
        {% endfor %}
      </div>
  </div>
</div>

<div class="container shadow-sm">
  <table class="text-center table table-borderless table-hover">
      <thead>
          <tr>
            <th>Member</th>
            <th>Tasks Assigned</th>
            <th>Last Seen</th>
            <th>View</th>
          </tr>
        </thead>
        <tbody>
          {% for member in item.members.all  %}
          <tr>
              <td>{{ member.username }}</td>
              <td>{{ member.work.all.count }}</td>
              <td>{{ member.last_login }}</td>
          </tr>
          {% endfor %}
        </tbody>
    </table>
</div>
{% endblock maincontent %}

{% block rightbar %}
  {% if user == item.owner or user in item.admin.all %}
    <div class="db-btn-holder"><button class="blue-btn-org scope-btn"><a href="{% url 'org:update-org' item.slug %}">Edit Organization</a></button></div>
    <div class="db-btn-holder"><button class="blue-btn-org org-btn-enlarge"><a href="{% url 'org:create-work' item.slug %}">Add Work</a></button></div>
  {% endif %}
{% endblock rightbar %}